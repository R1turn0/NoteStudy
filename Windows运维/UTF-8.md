# UTF-8

**UTF-8**（**8-bit Unicode Transformation Format**）是一种针对Unicode的可变长度符编码，也是一种前缀码。它可以用一至四个字节对Unicode字符集中的所有有效编码点进行编码，属于Unicode标准的一部分，最初由肯·汤普逊和罗布·派克提出。由于较小值的编码点一般使用频率较高，直接使用Unicode编码效率低下，大量浪费内存空间。UTF-8就是为了解决向后兼容ASCII码而设计，Unicode中前128个字符（与ASCII码一一对应），使用与ASCII码相同的二进制值的单个字节进行编码，这使得原来处理ASCII字符的软件无须或只须做少部分修改，即可继续使用。因此，它逐渐成为电子邮件、网页及其他存储或发送文字优先采用的编码方式。（摘自维基百科）

## 前缀码

要搞清楚UTF-8，先来弄懂一个概念——前缀码。

前缀码可以看作是一种编码要求，通常都是应用于**可变长编码**：每个码字都不能是另外一个码字的前缀，举例一个编码，其中有码字`0`,`1`,`00`，这就不是前缀码，当碰到`001010`这样的码串，计算机读到0到时候，是直接确定就是0，还是要继续读入后面一个得00呢？（因为是可变长编码，如果是定长编码，计算机是直接确定每次要读几位的）

## 长度可变的UTF-8

可变长编码有什么用呢？不知道大家还记不记得数据结构里学过的**哈夫曼树**呢，权值越是大的节点就离根节点越近的地方，对应得到的编码也就越短。在字符编码当中，权值越大的节点其实就是用的最多的字符，给这样字符的编码越短，那总长度就会越短，需要的存储空间就越小，这也就刚好解决的我们之前说的Unicode直接编码方式的痛点了。

那具体UTF-8是如何实现的呢？

## UTF-8的编码规则

UTF-8的编码规则就两条：

1）对于单字节的符号，字节的第一位设为`0`，后面7位为这个符号的 Unicode 码。因此对于英语字母，UTF-8 编码和 ASCII 码是相同的。

2）对于`n`字节的符号（`n > 1`），第一个字节的前`n`位都设为`1`，第`n + 1`位设为`0`，后面字节的前两位一律设为`10`。剩下的没有提及的二进制位，全部为这个符号的 Unicode 码。

```text
 Unicode符号范围     |       UTF-8编码方式
 (十六进制)          |         （二进制）
 ----------------------+---------------------------------------------
 0000 0000-0000 007F | 0xxxxxxx
 0000 0080-0000 07FF | 110xxxxx 10xxxxxx
 0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
 0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx 
```

首先是单子节的字符，字符第一位直接是0，这样计算机在碰到0开头的字节时，就直接可以根据后7位确定是哪个字符了。而如果开头不是0，那么继续看后面，一直看到0，就可以确定前面有多少个1了，而1的个数，就是这个字符所占的字节个数，比如读到了1110xxxx，那么计算机就知道除了这个在读的字节，后面还有两个字节，这三个字节代表一个字符。

那么就剩一个问题了，为什么后续的字节10xxxxxx都是10开头，前面解释的规则其实就已经能保证逐字节读入的时候是满足前缀码性质的不是吗？即使后面子节不以10开头也可以啊，因为计算机此时已经知道要读几个字节了。这里大家可以思考一下～