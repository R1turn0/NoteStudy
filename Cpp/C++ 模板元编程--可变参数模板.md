# C++ æ¨¡æ¿å…ƒç¼–ç¨‹--å¯å˜å‚æ•°æ¨¡æ¿

[TOC]

## å¯å˜æ¨¡æ¿çš„å‚æ•°å±•å¼€

å¯å˜å‚æ•°æ¨¡æ¿å’Œæ™®é€šæ¨¡æ¿çš„è¯­ä¹‰æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å†™æ³•ä¸Šç¨æœ‰åŒºåˆ«ï¼Œå£°æ˜å¯å˜å‚æ•°æ¨¡æ¿æ—¶éœ€è¦åœ¨ `typename` æˆ– `class` åé¢å¸¦ä¸Šçœç•¥å·ã€Œ...ã€ã€‚æ¯”å¦‚æˆ‘ä»¬å¸¸å¸¸è¿™æ ·å£°æ˜ä¸€ä¸ªå¯å˜æ¨¡æ¿å‚æ•°ï¼š `template<typename...>` æˆ–è€… `template<class...>`ï¼Œä¸€ä¸ªå…¸å‹çš„å¯å˜æ¨¡æ¿å‚æ•°çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š

```C++
template <typename... T>
void f(T... args);
```

ä¸Šé¢çš„å¯å˜æ¨¡æ¿å‚æ•°çš„å®šä¹‰å½“ä¸­ï¼Œçœç•¥å·çš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼š

å£°æ˜ä¸€ä¸ªå‚æ•°åŒ… `T... args`ï¼Œè¿™ä¸ªå‚æ•°åŒ…ä¸­å¯ä»¥åŒ…å« `0` åˆ°ä»»æ„ä¸ªæ¨¡æ¿å‚æ•°ï¼›
åœ¨æ¨¡æ¿å®šä¹‰çš„å³è¾¹ï¼Œå¯ä»¥å°†å‚æ•°åŒ…å±•å¼€æˆä¸€ä¸ªä¸€ä¸ªç‹¬ç«‹çš„å‚æ•°ã€‚
ä¸Šé¢çš„å‚æ•° `args` ã€Œå‰é¢ã€æœ‰çœç•¥å·ï¼Œæ‰€ä»¥å®ƒå°±æ˜¯ä¸€ä¸ªå¯å˜æ¨¡æ¿å‚æ•°ï¼Œæˆ‘ä»¬æŠŠå¸¦çœç•¥å·çš„å‚æ•°ç§°ä¸ºâ€œå‚æ•°åŒ…â€ï¼Œå®ƒé‡Œé¢åŒ…å«äº† `0` åˆ° `N` ï¼ˆN>=0ï¼‰ä¸ªæ¨¡æ¿å‚æ•°ã€‚æˆ‘ä»¬æ— æ³•ç›´æ¥è·å–å‚æ•°åŒ… `args` ä¸­çš„æ¯ä¸ªå‚æ•°çš„ï¼Œåªèƒ½é€šè¿‡ã€Œå±•å¼€å‚æ•°åŒ…ã€çš„æ–¹å¼æ¥è·å–å‚æ•°åŒ…ä¸­çš„æ¯ä¸ªå‚æ•°ï¼Œè¿™æ˜¯ä½¿ç”¨å¯å˜æ¨¡æ¿å‚æ•°çš„ä¸€ä¸ªã€Œä¸»è¦ç‰¹ç‚¹ã€ï¼Œä¹Ÿæ˜¯ã€Œæœ€å¤§çš„éš¾ç‚¹ã€ï¼Œå³å¦‚ä½•å±•å¼€å¯å˜æ¨¡æ¿å‚æ•°ã€‚

å¯å˜æ¨¡æ¿å‚æ•°å’Œæ™®é€šçš„æ¨¡æ¿å‚æ•°è¯­ä¹‰æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¯ä»¥åº”ç”¨äºå‡½æ•°å’Œç±»ï¼Œå³ã€Œå¯å˜å‚æ•°æ¨¡æ¿å‡½æ•°ã€å’Œã€Œå¯å˜å‚æ•°æ¨¡æ¿ç±»ã€ï¼Œç„¶è€Œï¼Œ**æ¨¡æ¿å‡½æ•°ä¸æ”¯æŒåç‰¹åŒ–**ï¼Œæ‰€ä»¥å¯å˜å‚æ•°æ¨¡æ¿å‡½æ•°å’Œå¯å˜å‚æ•°æ¨¡æ¿ç±»å±•å¼€å¯å˜å‚æ•°çš„æ–¹æ³•è¿˜ä¸å°½ç›¸åŒï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†åˆ«çœ‹çœ‹ä»–ä»¬å±•å¼€å¯å˜å‚æ•°çš„æ–¹æ³•ã€‚

### 1. å¯å˜å‚æ•°å‡½æ•°æ¨¡æ¿
ä¸€ä¸ªç®€å•çš„å¯å˜å‚æ•°å‡½æ•°æ¨¡æ¿ï¼š

```C++
#include <iostream>
using namespace std;

template<typename... Args>
void f(Args... args) {
    cout << sizeof...(args) << endl;
}

int main() {
    f();        // 0
    f(1, 2);    // 2
    f(1, 2, "");// 3
    return 0;
}
```

ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ `f()` æ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œæ‰€ä»¥å‚æ•°åŒ…ä¸ºç©ºï¼Œè¾“å‡ºçš„ size ä¸º0ï¼Œåé¢ä¸¤æ¬¡è°ƒç”¨åˆ†åˆ«ä¼ å…¥ä¸¤ä¸ªå’Œä¸‰ä¸ªå‚æ•°ï¼Œæ•…è¾“å‡ºçš„ size åˆ†åˆ«ä¸º2å’Œ3ã€‚ç”±äºå¯å˜æ¨¡æ¿å‚æ•°çš„ç±»å‹å’Œä¸ªæ•°æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¼ ä»»æ„ç±»å‹å’Œä¸ªæ•°çš„å‚æ•°ç»™å‡½æ•°fã€‚è¿™ä¸ªä¾‹å­åªæ˜¯ç®€å•çš„å°†å¯å˜å‚æ•°æ¨¡æ¿çš„ä¸ªæ•°æ‰“å°å‡ºæ¥ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å°†å‚æ•°åŒ…ä¸­çš„æ¯ä¸ªå‚æ•°æ‰“å°å‡ºæ¥çš„è¯å°±éœ€è¦é€šè¿‡ä¸€äº›æ–¹æ³•äº†ã€‚å±•å¼€å¯å˜æ¨¡æ¿å‚æ•°å‡½æ•°çš„æ–¹æ³•ä¸€èˆ¬æœ‰ä¸¤ç§ï¼š

ä¸€ç§æ˜¯é€šè¿‡ã€Œé€’å½’å‡½æ•°ã€æ¥å±•å¼€å‚æ•°åŒ…
å¦å¤–ä¸€ç§æ˜¯é€šè¿‡ã€Œé€—å·è¡¨è¾¾å¼ã€æ¥å±•å¼€å‚æ•°åŒ…
ä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•ç”¨è¿™ä¸¤ç§æ–¹æ³•æ¥å±•å¼€å‚æ•°åŒ…ã€‚

#### a) é€’å½’å‡½æ•°æ–¹å¼å±•å¼€å‚æ•°åŒ…

é€šè¿‡é€’å½’å‡½æ•°å±•å¼€å‚æ•°åŒ…ï¼Œéœ€è¦æä¾›ä¸€ä¸ªã€Œå‚æ•°åŒ…å±•å¼€çš„å‡½æ•°ã€å’Œä¸€ä¸ªã€Œé€’å½’ç»ˆæ­¢å‡½æ•°ã€ï¼Œé€’å½’ç»ˆæ­¢å‡½æ•°æ­£æ˜¯ç”¨æ¥ç»ˆæ­¢é€’å½’çš„ï¼Œæ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚

```C++
#include <iostream>
using namespace std;

// @note é€’å½’ç»ˆæ­¢å‡½æ•°
void print() {
    cout << "empty" << endl;
}

// @note å±•å¼€å‡½æ•°
template<typename T, typename... Args>
void print(T head, Args... args) {
    cout << "parameter " << head << endl;
    print(args...);
}

int main() {
    print(1, 2, 3, 4);
    return 0;
}
```


ä¸Šä¾‹ä¼šè¾“å‡ºæ¯ä¸€ä¸ªå‚æ•°ï¼Œç›´åˆ°ä¸ºç©ºæ—¶è¾“å‡º `empty`ã€‚å±•å¼€å‚æ•°åŒ…çš„å‡½æ•°æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯é€’å½’å‡½æ•°ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯é€’å½’ç»ˆæ­¢å‡½æ•°ï¼Œå‚æ•°åŒ… `Args...` åœ¨å±•å¼€çš„è¿‡ç¨‹ä¸­é€’å½’è°ƒç”¨è‡ªå·±ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡å‚æ•°åŒ…ä¸­çš„å‚æ•°å°±ä¼šå°‘ä¸€ä¸ªï¼Œç›´åˆ°æ‰€æœ‰çš„å‚æ•°éƒ½å±•å¼€ä¸ºæ­¢ï¼Œå½“æ²¡æœ‰å‚æ•°æ—¶ï¼Œåˆ™è°ƒç”¨éæ¨¡æ¿å‡½æ•° `print` ç»ˆæ­¢é€’å½’è¿‡ç¨‹ã€‚

é€’å½’è°ƒç”¨çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š

```C++
print(1,2,3,4);
print(2,3,4);
print(3,4);
print(4);
print();
```

ä¸Šé¢çš„é€’å½’ç»ˆæ­¢å‡½æ•°è¿˜å¯ä»¥å†™æˆè¿™æ ·ï¼š

```C++template<typename T>
void print(T t) {
    cout << t << endl;
}
```

ä¿®æ”¹é€’å½’ç»ˆæ­¢å‡½æ•°åï¼Œä¸Šä¾‹ä¸­çš„è°ƒç”¨è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š

```C++print(1, 2, 3, 4);
print(2, 3, 4);
print(3, 4);
print(4);
```

å½“å‚æ•°åŒ…å±•å¼€åˆ°æœ€åä¸€ä¸ªå‚æ•°æ—¶é€’å½’ç»ˆæ­¢ã€‚

å†çœ‹ä¸€ä¸ªé€šè¿‡å¯å˜æ¨¡æ¿å‚æ•°æ±‚å’Œçš„ä¾‹å­ï¼š

```C++
#include <iostream>
using namespace std;

template<typename T>
T sum(T t) {
    return t;
}

template<typename T, typename... Types>
T sum(T first, Types... rest) {
    return first + sum<T>(rest...);
}

int main() {
    cout << sum(1, 2, 3, 4) << endl;    // 10
    return 0;
}
```

`sum` åœ¨å±•å¼€å‚æ•°åŒ…çš„è¿‡ç¨‹ä¸­å°†å„ä¸ªå‚æ•°ç›¸åŠ æ±‚å’Œï¼Œå‚æ•°çš„å±•å¼€æ–¹å¼å’Œå‰é¢çš„æ‰“å°å‚æ•°åŒ…çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚

#### b) é€—å·è¡¨è¾¾å¼å±•å¼€å‚æ•°åŒ…

é€’å½’å‡½æ•°å±•å¼€å‚æ•°åŒ…æ˜¯ä¸€ç§æ ‡å‡†åšæ³•ï¼Œä¹Ÿæ¯”è¾ƒå¥½ç†è§£ï¼Œä½†ä¹Ÿæœ‰ä¸€ä¸ªç¼ºç‚¹,å°±æ˜¯ã€Œå¿…é¡»ã€è¦ä¸€ä¸ªé‡è½½çš„é€’å½’ç»ˆæ­¢å‡½æ•°ï¼Œå³ã€Œå¿…é¡»ã€è¦æœ‰ä¸€ä¸ªåŒåçš„ç»ˆæ­¢å‡½æ•°æ¥ç»ˆæ­¢é€’å½’ï¼Œè¿™æ ·å¯èƒ½ä¼šæ„Ÿè§‰ç¨æœ‰ä¸ä¾¿ã€‚æœ‰æ²¡æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹å¼å‘¢ï¼Ÿå…¶å®è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä¸é€šè¿‡é€’å½’æ–¹å¼æ¥å±•å¼€å‚æ•°åŒ…ï¼Œè¿™ç§æ–¹å¼éœ€è¦å€ŸåŠ©ã€Œé€—å·è¡¨è¾¾å¼ã€å’Œã€Œåˆå§‹åŒ–åˆ—è¡¨ã€ã€‚æ¯”å¦‚å‰é¢printçš„ä¾‹å­å¯ä»¥æ”¹æˆè¿™æ ·ï¼š

```C++
#include <iostream>
using namespace std;

template<typename T>
void printArg(T t) {
    cout << t << endl;
}

template<typename... Args>
void expand(Args... args) {
    int arr[] = {(printArg(args), 0)...};
}

int main() {
    expand(1, 2, 3, 4);
    return 0;
}
```

è¿™ä¸ªä¾‹å­å°†åˆ†åˆ«æ‰“å°å‡º1ã€2ã€3ã€4å››ä¸ªæ•°å­—ã€‚è¿™ç§å±•å¼€å‚æ•°åŒ…çš„æ–¹å¼ï¼Œã€Œä¸éœ€è¦ã€é€šè¿‡é€’å½’ç»ˆæ­¢å‡½æ•°ï¼Œæ˜¯ç›´æ¥åœ¨expandå‡½æ•°ä½“ä¸­å±•å¼€çš„,printArgä¸æ˜¯ä¸€ä¸ªé€’å½’ç»ˆæ­¢å‡½æ•°ï¼Œåªæ˜¯ä¸€ä¸ªå¤„ç†å‚æ•°åŒ…ä¸­æ¯ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ã€‚è¿™ç§å°±åœ°å±•å¼€å‚æ•°åŒ…çš„æ–¹å¼å®ç°çš„å…³é”®æ˜¯é€—å·è¡¨è¾¾å¼ã€‚æˆ‘ä»¬çŸ¥é“é€—å·è¡¨è¾¾å¼ä¼šæŒ‰é¡ºåºæ‰§è¡Œé€—å·å‰é¢çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼š

```C++
d = (a = b, c);
```

è¿™ä¸ªè¡¨è¾¾å¼ä¼šæŒ‰é¡ºåºæ‰§è¡Œï¼šbä¼šå…ˆèµ‹å€¼ç»™aï¼Œæ¥ç€æ‹¬å·ä¸­çš„é€—å·è¡¨è¾¾å¼è¿”å›cçš„å€¼ï¼Œå› æ­¤då°†ç­‰äºcã€‚

expand å‡½æ•°ä¸­çš„é€—å·è¡¨è¾¾å¼ï¼š

```C++
(printArg(args), 0)
```

ä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªæ‰§è¡Œé¡ºåºï¼Œå…ˆæ‰§è¡Œ `printArg(args)`ï¼Œå†å¾—åˆ°é€—å·è¡¨è¾¾å¼çš„ç»“æœ0ã€‚åŒæ—¶è¿˜ç”¨åˆ°äº†C++11çš„å¦å¤–ä¸€ä¸ªç‰¹æ€§ï¼šã€Œåˆå§‹åŒ–åˆ—è¡¨ã€ï¼Œé€šè¿‡åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–ä¸€ä¸ªã€Œå˜é•¿æ•°ç»„ã€ï¼š

```C++
{(printArg(args), 0)...}
```

å°†ä¼šå±•å¼€æˆ

```C++
{((printArg(arg1), 0), (printArg(arg2), 0), (printArg(arg3), 0),  etc...)}
```

æœ€ç»ˆä¼šåˆ›å»ºä¸€ä¸ªå…ƒç´ å€¼éƒ½ä¸º0çš„æ•°ç»„ `int arr[sizeof...(Args)]`ã€‚ç”±äºæ˜¯é€—å·è¡¨è¾¾å¼ï¼Œåœ¨åˆ›å»ºæ•°ç»„çš„è¿‡ç¨‹ä¸­ä¼šå…ˆæ‰§è¡Œé€—å·è¡¨è¾¾å¼å‰é¢çš„éƒ¨åˆ† `printArg(args)` æ‰“å°å‡ºå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ„é€ intæ•°ç»„çš„è¿‡ç¨‹ä¸­å°±å°†å‚æ•°åŒ…å±•å¼€äº†ï¼Œè¿™ä¸ªæ•°ç»„çš„ç›®çš„çº¯ç²¹æ˜¯ä¸ºäº†åœ¨æ•°ç»„æ„é€ çš„è¿‡ç¨‹å±•å¼€å‚æ•°åŒ…ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ä¾‹å­å†è¿›ä¸€æ­¥æ”¹è¿›ä¸€ä¸‹ï¼Œå°†å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°±å¯ä»¥æ”¯æŒ `lambda` è¡¨è¾¾å¼äº†ï¼Œä»è€Œå¯ä»¥å°‘å†™ä¸€ä¸ªé€’å½’ç»ˆæ­¢å‡½æ•°äº†ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```C++
#include <iostream>
#include <functional>
using namespace std;

template<typename T, typename ...Args>
void expand(const T &func, Args&&... args) {
    // è¿™é‡Œç”¨åˆ°äº†å®Œç¾è½¬å‘
    int arr[] = { (func(std::forward<Args>(args)), 0)... };
    // initializer_list<int>{ (func(std::forward<Args>(args)), 0)... };
}

int main() {
    expand([](int i)->void{cout << i << endl;}, 1, 2, 3);
    return 0;
}
```

å…¶å®ä¸Šé¢è¿™é‡Œçš„Tç±»å‹å°±æ˜¯ `function<void int>` ç±»å‹ï¼Œå‚æ•°å¯ä»¥å†™æˆ `const function<void(int)> &func`ï¼Œä¹Ÿå¯å†™æˆ `function<void(int)> func`ï¼Œè¿™éƒ½æ— å¦¨ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“è¿™æ˜¯å¼•ç”¨ã€æˆ–è€…æ˜¯ä½¿ç”¨äº† `function` æœºåˆ¶å³å¯ã€‚

ä¸Šé¢çš„ä¾‹å­å°†æ‰“å°å‡ºæ¯ä¸ªå‚æ•°ï¼Œè¿™é‡Œå¦‚æœå†ä½¿ç”¨ã€ŒC++14çš„æ–°ç‰¹æ€§ã€æ³›å‹ `lambda` è¡¨è¾¾å¼çš„è¯ï¼Œå¯ä»¥å†™æ›´æ³›åŒ–çš„lambdaè¡¨è¾¾å¼äº†ï¼ˆæŠŠå‚æ•°æ”¹ä¸ºautoï¼‰ï¼š

```C++
expand([](auto i)->void{cout << i << endl;}, 1, 2.2, "hello");
```

### 2. å¯å˜å‚æ•°ç±»æ¨¡æ¿

å¯å˜å‚æ•°æ¨¡æ¿ç±»æ˜¯ä¸€ä¸ªå¸¦å¯å˜å‚æ•°çš„æ¨¡æ¿ç±»ï¼Œæ¯”å¦‚ C++11 ä¸­çš„å…ƒç»„ `std::tuple` å°±æ˜¯ä¸€ä¸ªå¯å˜æ¨¡æ¿ç±»ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š

```C++
template<typename... Types>
class tuple;
```

è¿™ä¸ªå¯å˜å‚æ•°æ¨¡æ¿ç±»å¯ä»¥æºå¸¦ä»»æ„ç±»å‹ä»»æ„ä¸ªæ•°çš„æ¨¡æ¿å‚æ•°ï¼š

```C++
std::tuple<int> tp1 = std::make_tuple(1);
std::tuple<int, double> tp2 = std::make_tuple(1, 2.5);
std::tuple<int, double, string> tp3 = std::make_tuple(1, 2.5, "");
//std::tuple<int, double, string> tp3 = {1, 2.5, ""};
//std::tuple<int, double, string> tp3(1, 2.5, "");
```

å¯å˜å‚æ•°æ¨¡æ¿ç±»çš„å‚æ•°ä¸ªæ•°å¯ä»¥ä¸º0ä¸ªï¼Œæ‰€ä»¥ä¸‹é¢çš„å®šä¹‰ä¹Ÿæ˜¯ä¹Ÿæ˜¯åˆæ³•çš„ï¼š

```C++
std::tuple<> tp;
```

å¯å˜å‚æ•°æ¨¡æ¿ç±»çš„å‚æ•°åŒ…å±•å¼€çš„æ–¹å¼å’Œå¯å˜å‚æ•°æ¨¡æ¿å‡½æ•°çš„å±•å¼€æ–¹å¼ä¸åŒï¼Œå¯å˜å‚æ•°æ¨¡æ¿ç±»çš„å‚æ•°åŒ…å±•å¼€éœ€è¦é€šè¿‡ã€Œæ¨¡æ¿ç‰¹åŒ–ã€å’Œã€Œç»§æ‰¿æ–¹å¼ã€å»å±•å¼€ï¼Œå±•å¼€æ–¹å¼æ¯”å¯å˜å‚æ•°æ¨¡æ¿å‡½æ•°è¦å¤æ‚ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å±•å¼€å¯å˜å‚æ•°æ¨¡æ¿ç±»ä¸­çš„å‚æ•°åŒ…çš„æ–¹æ³•ã€‚

#### a) æ¨¡æ¿åç‰¹åŒ–å’Œé€’å½’æ–¹å¼æ¥å±•å¼€å‚æ•°åŒ…

å¯å˜å‚æ•°æ¨¡æ¿ç±»çš„å±•å¼€ä¸€èˆ¬éœ€è¦å®šä¹‰ä¸¤åˆ°ä¸‰ä¸ªç±»ï¼ŒåŒ…æ‹¬ã€Œç±»å£°æ˜ã€å’Œã€Œåç‰¹åŒ–ã€çš„æ¨¡æ¿ç±»ã€‚å¦‚ä¸‹æ–¹å¼å®šä¹‰äº†ä¸€ä¸ªåŸºæœ¬çš„å¯å˜å‚æ•°æ¨¡æ¿ç±»ï¼š

```C++
#include <iostream>
using namespace std;

// å‰å‘å£°æ˜
template<typename... Args>
struct Sum;

// åŸºæœ¬å®šä¹‰
template<typename First, typename... Rest>
struct Sum<First, Rest...> {
    enum {
        value = Sum<First>::value + Sum<Rest...>::value
    };
};

// é€’å½’ç»ˆæ­¢
template<typename Last>
struct Sum<Last> {
    enum {
        value = sizeof(Last)
    };
};

int main() {
    cout << Sum<int, double, short>::value << endl; // 14
    // Sum<int, double, short> s;
    // cout << s.value << endl;                     // 4+8+2=14
    return 0;
}
```

è¿™ä¸ª `Sum` ç±»çš„ä½œç”¨æ˜¯åœ¨ç¼–è¯‘æœŸè®¡ç®—å‡ºå‚æ•°åŒ…ä¸­å‚æ•°ç±»å‹çš„ size ä¹‹å’Œï¼Œé€šè¿‡ `Sum<int, double, short>::value` å°±å¯ä»¥è·å–è¿™3ä¸ªç±»å‹çš„ size ä¹‹å’Œä¸º14ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„é€šè¿‡å¯å˜å‚æ•°æ¨¡æ¿ç±»è®¡ç®—çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªåŸºæœ¬çš„å¯å˜å‚æ•°æ¨¡æ¿åº”ç”¨ç±»ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

ã€Œç¬¬ä¸€éƒ¨åˆ†ã€æ˜¯ï¼š

```C++
template<typename... Args>
struct Sum;
```

å®ƒæ˜¯å‰å‘å£°æ˜ï¼Œå£°æ˜è¿™ä¸ª `Sum` ç±»æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°æ¨¡æ¿ç±»ï¼›

ã€Œç¬¬äºŒéƒ¨åˆ†ã€æ˜¯ç±»çš„å®šä¹‰ï¼š

```C++
template<typename First, typename... Rest>
struct Sum<First, Rest...> {
    enum {
        value = Sum<First>::value + Sum<Rest...>::value
    };
};
```

å®ƒå®šä¹‰äº†ä¸€ä¸ªéƒ¨åˆ†å±•å¼€çš„å¯å˜å‚æ•°æ¨¡æ¿ç±»ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å¦‚ä½•é€’å½’å±•å¼€å‚æ•°åŒ…ã€‚

ã€Œç¬¬ä¸‰éƒ¨åˆ†ã€æ˜¯ç‰¹åŒ–çš„é€’å½’ç»ˆæ­¢ç±»ï¼š

```C++
template<typename Last>
struct Sum<Last> {
    enum {
        value = sizeof(Last)
    };
};
```

é€šè¿‡è¿™ä¸ªç‰¹åŒ–çš„ç±»æ¥ç»ˆæ­¢é€’å½’ã€‚

```C++
template<typename First, typename... Args>
struct Sum<First, Rest...> {
    ...
};
```

è¿™ä¸ªå‰å‘å£°æ˜è¦æ±‚ `Sum` çš„æ¨¡æ¿å‚æ•°è‡³å°‘æœ‰ä¸€ä¸ªï¼Œå› ä¸ºå¯å˜å‚æ•°æ¨¡æ¿ä¸­çš„æ¨¡æ¿å‚æ•°å¯ä»¥æœ‰0ä¸ªï¼Œæœ‰æ—¶å€™0ä¸ªæ¨¡æ¿å‚æ•°æ²¡æœ‰æ„ä¹‰ï¼Œå°±å¯ä»¥é€šè¿‡ä¸Šé¢çš„å£°æ˜æ–¹å¼æ¥é™å®šæ¨¡æ¿å‚æ•°ä¸èƒ½ä¸º0ä¸ªã€‚ä¸Šé¢çš„è¿™ç§ä¸‰æ®µå¼çš„å®šä¹‰ä¹Ÿå¯ä»¥æ”¹ä¸ºä¸¤æ®µå¼çš„ï¼Œå¯ä»¥å°†å‰å‘å£°æ˜å»æ‰ï¼Œè¿™æ ·å®šä¹‰ï¼š

```C++
#include <iostream>
using namespace std;

// åŸºæœ¬æ¨¡æ¿ç±»å®šä¹‰
template<typename First, typename... Rest>
struct Sum {
    enum {
        value = Sum<First>::value + Sum<Rest...>::value
    };
};

// ç‰¹åŒ–çš„ç»ˆæ­¢å‡½æ•°
template<typename Last>
struct Sum<Last> {
    enum {
        value = sizeof(Last)
    };
};

int main() {
    cout << Sum<int, double, short>::value << endl; // 14
    // Sum<int, double, short> s;
    // cout << s.value << endl;                     // 4+8+2=14
    return 0;
}
```

ä¸Šé¢çš„æ–¹å¼ã€Œåªè¦ã€ä¸€ä¸ªåŸºæœ¬çš„ã€Œæ¨¡æ¿ç±»å®šä¹‰ã€å’Œä¸€ä¸ªã€Œç‰¹åŒ–çš„ç»ˆæ­¢å‡½æ•°ã€å°±è¡Œäº†ï¼Œè€Œä¸”é™å®šäº†æ¨¡æ¿å‚æ•°è‡³å°‘æœ‰ä¸€ä¸ªã€‚

é€’å½’ç»ˆæ­¢æ¨¡æ¿ç±»å¯ä»¥æœ‰ã€Œå¤šç§å†™æ³•ã€ï¼Œæ¯”å¦‚ä¸Šä¾‹çš„é€’å½’ç»ˆæ­¢æ¨¡æ¿ç±»è¿˜å¯ä»¥è¿™æ ·å†™ï¼š

```C++
#include <iostream>
using namespace std;

template<typename... Args>
struct Sum;

// åŸºæœ¬æ¨¡æ¿ç±»å®šä¹‰
template<typename First, typename... Rest>
struct Sum<First, Rest...> {
    enum {
        value = sizeof(First) + Sum<Rest...>::value
    };
};

// é€’å½’ç»ˆæ­¢æ¨¡æ¿ç±»
template<typename First, typename Last>
struct Sum<First, Last> {
    enum {
        value = sizeof(First) + sizeof(Last)
    };
};

int main() {
    // cout << Sum<>::value << endl;                   // error
    // cout << Sum<int>::value << endl;                // error
    cout << Sum<int, double>::value << endl;        // 12
    cout << Sum<int, double, short>::value << endl; // 14
    return 0;
}
```

åœ¨å±•å¼€åˆ°æœ€åä¸¤ä¸ªå‚æ•°æ—¶ç»ˆæ­¢ã€‚

è¿˜å¯ä»¥åœ¨å±•å¼€åˆ°0ä¸ªå‚æ•°æ—¶ç»ˆæ­¢ï¼š

```C++
#include <iostream>
using namespace std;

template<typename... Args>
struct Sum;

// åŸºæœ¬æ¨¡æ¿ç±»å®šä¹‰
template<typename First, typename... Rest>
struct Sum<First, Rest...> {
    enum {
        value = sizeof(First) + Sum<Rest...>::value
    };
};

// é€’å½’ç»ˆæ­¢æ¨¡æ¿ç±»
template<>
struct Sum<> {
    enum {
        value = 0
    };
};

int main() {
    cout << Sum<>::value << endl;                   // 0
    cout << Sum<int>::value << endl;                // 4
    cout << Sum<int, double>::value << endl;        // 12
    cout << Sum<int, double, short>::value << endl; // 14
    return 0;
}
```

> âš ï¸æ³¨ï¼šæˆ‘ä¸€å¼€å§‹å¯¹é€’å½’ç»ˆæ­¢æ¡ä»¶é‚£é‡Œçš„ã€Œå±•å¼€åˆ°2ä¸ªå‚æ•°ã€å’Œã€Œå±•å¼€åˆ°0ä¸ªå‚æ•°ã€çš„ä»£ç æ”¹æ¥æ”¹å»å°±æ˜¯è·‘ä¸é€šï¼Œå‘ç°æ˜¯ã€ŒåŸºæœ¬æ¨¡æ¿ç±»å®šä¹‰ã€é‚£é‡Œå‡ºäº†é—®é¢˜ï¼Œå°†ä¸€å¼€å§‹çš„Sum<First>::valueæ”¹ä¸ºsizeof(First)å³å¯ã€‚å¯¹ã€Œå±•å¼€åˆ°2ä¸ªå‚æ•°ã€çš„ä»£ç è€Œè¨€ï¼Œè‹¥ä¸è¿›è¡Œã€ŒåŸºæœ¬æ¨¡æ¿ç±»å®šä¹‰ã€è¿™é‡Œçš„ä¿®æ”¹ï¼Œé‚£åªèƒ½ä¿è¯ä¼ å…¥çš„å‚æ•°ä¸ªæ•°æ˜¯>=2çš„å¶æ•°ä¸ªï¼Œè€Œå½“å‚æ•°ä¸ªæ•°ä¸ºå¥‡æ•°ä¸ªæ—¶ï¼Œå°±ä¼šæŠ¥é”™ï¼Œè¿™é‡Œå¯ä»¥ä»”ç»†æƒ³æƒ³ä¸ºä»€ä¹ˆï¼Œé‚£ä¹ˆå¯¹ã€Œå±•å¼€åˆ°0ä¸ªå‚æ•°ã€çš„æƒ…å†µï¼ŒåŒç†ï¼Œå°±ä¸å†èµ˜è¿°ã€‚

é‚£ä¹ˆè¯´åˆ°è¿™é‡Œï¼Œæƒ³å¿…å¤§å®¶éƒ½æœ‰ä¸ªç–‘æƒ‘ï¼Œå¯ä»¥çœ‹åˆ°ä¸è®ºæ˜¯æ¨¡æ¿å‡½æ•°è¿˜æ˜¯æ¨¡æ¿ç±»çš„é€’å½’ç¨‹åºï¼Œéƒ½ç”¨åˆ°äº†enumåšé€’å½’çš„æ•°å€¼è®¡ç®—ã€‚åœ¨æ¨¡æ¿å…ƒç¼–ç¨‹ä¸­ï¼Œenumæ˜¯ä¸€é¡¹é‡è¦æ‰‹æ®µã€‚å…¶ä¸»è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼š

1. `enum` çš„ã€Œå€¼ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´è®¡ç®—ã€
2. åˆ©ç”¨é€’å½’ç®—æ³•å’Œæ¨¡æ¿ç‰¹åŒ–ï¼Œå¯ä»¥è®©ç¼–è¯‘å™¨åœ¨è®¡ç®— `enum` å€¼æ—¶ã€Œé€’å½’äº§ç”Ÿä¸€ç³»åˆ—classã€
   ä¸‹é¢ç›´æ¥ç½—åˆ—ä¸€ä¸ªæ±‚Nçš„é˜¶ä¹˜çš„ä»£ç ï¼Œå¯ä»¥ä½“ä¼šä¸€ä¸‹å¦‚ä½•åœ¨æ¨¡æ¿ä¸­å€ŸåŠ©é€’å½’ç®—æ³•å’Œæ¨¡æ¿ç‰¹åŒ–æ¥ä½¿ç”¨ `enum` å®ç°Nçš„é˜¶ä¹˜ï¼š

```C++
#include <iostream>
using namespace std;

template<int N>
class F {
public:
    enum {
        res = N * F<N-1>::res
    };
};

//é€’å½’ç»ˆæ­¢æ¡ä»¶
template<>
class F<1> {
public:
    enum {
        res = 1
    };
};

int main() {
    cout << F<4>::res << endl; // 24 = 1*2*3*4
    return 0;
}
```

C++æ¨¡æ¿å…ƒç¼–ç¨‹ä¸­æœ‰ä¸ªé‡è¦çš„ç±»å«åš `std::integral_constant`ï¼Œç”¨æ¥å®šä¹‰ç±»å‹çš„å¸¸é‡ï¼Œå…¶å®å¯ä»¥ä½¿ç”¨ `std::integral_constant` æ¥æ¶ˆé™¤æšä¸¾å®šä¹‰ã€‚åˆ©ç”¨ `std::integral_constant` ä¹Ÿå¯è·å¾—ã€Œç¼–è¯‘æœŸå¸¸é‡ã€çš„ç‰¹æ€§ã€‚æºç ä¹‹ä¸‹äº†æ— ç§˜å¯†ï¼Œ`std::intergral_constant` çš„æºç å¦‚ä¸‹ï¼š

```C++
template<typename _Tp, _Tp __v>
struct integral_constant {
    static constexpr _Tp value = __v;
    typedef _Tp value_type;
    typedef integral_constant<_Tp, __v> type;

    constexpr operator value_type() const noexcept { return value; }

#if __cplusplus > 201103L

#define __cpp_lib_integral_constant_callable 201304

    constexpr value_type operator()() const noexcept { return value; } //C++14èµ·
#endif
};
```

æœ¬æ–‡å¯¹è¯¥æ¨¡æ¿ç±»ä¸åšè¯´æ˜ï¼Œæˆ‘ç›´æ¥è´´å‡ºç›¸å…³æ–‡ç« ï¼š[ ğŸ”— C++11ä¸­type_traitsä¸­çš„åŸºçŸ³ - integral_constant ](https://flushhip.blog.csdn.net/article/details/82993411)ï¼Œç­‰åé¢æœ‰æœºä¼šæˆ‘å†å•ç‹¬æä¸€ä¸‹è¿™é‡Œã€‚

å› æ­¤ï¼Œå¯ä»¥å°†å‰é¢çš„ `Sum` ä¾‹å­æ”¹ä¸ºè¿™æ ·ï¼š

```C++
#include <iostream>
using namespace std;

//å‰å‘å£°æ˜
template <typename... Args>
struct Sum;

//åŸºæœ¬å®šä¹‰
template <typename First, typename... Rest>
struct Sum<First, Rest...> : std::integral_constant<int, Sum<First>::value + Sum<Rest...>::value>
{};

//é€’å½’ç»ˆæ­¢
template<typename Last>
struct Sum<Last> : std::integral_constant<int, sizeof(Last)>
{};

int main() {
    cout << Sum<int, double, short>::value << endl; // 14 = 4+8+2
    return 0;
}
```

#### b) ç»§æ‰¿æ–¹å¼å±•å¼€å‚æ•°åŒ…
è¿˜å¯ä»¥é€šè¿‡ç»§æ‰¿æ–¹å¼æ¥å±•å¼€å‚æ•°åŒ…ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­å°±æ˜¯é€šè¿‡ç»§æ‰¿çš„æ–¹å¼å»å±•å¼€å‚æ•°åŒ…ï¼š

```C++
//æ•´å‹åºåˆ—çš„å®šä¹‰
template<int...>
struct IndexSeq {};

//ç»§æ‰¿æ–¹å¼ï¼Œå¼€å§‹å±•å¼€å‚æ•°åŒ…
template<int N, int... Indexes>
struct MakeIndexes : MakeIndexes<N-1, N-1, Indexes...> {};

// æ¨¡æ¿ç‰¹åŒ–ï¼Œç»ˆæ­¢å±•å¼€å‚æ•°åŒ…çš„æ¡ä»¶
template<int... Indexes>
struct MakeIndexes<0, Indexes...> {
    using type = IndexSeq<Indexes...>;
};

int main() {
    using T = MakeIndexes<3>::type;
    cout << typeid(T).name() << endl; // IndexSeq<0, 1, 2>
    return 0;
}
```

å…¶ä¸­ `MakeIndexes` çš„ä½œç”¨æ˜¯ä¸ºäº†ç”Ÿæˆä¸€ä¸ªå¯å˜å‚æ•°æ¨¡æ¿ç±»çš„æ•´æ•°åºåˆ—ï¼Œã€Œæœ€ç»ˆè¾“å‡ºã€çš„ç±»å‹æ˜¯ï¼š`struct IndexSeq<0, 1, 2>`ã€‚

`MakeIndexes` ç»§æ‰¿äºè‡ªèº«çš„ä¸€ä¸ªã€Œç‰¹åŒ–çš„ã€æ¨¡æ¿ç±»ï¼Œè¿™ä¸ªç‰¹åŒ–çš„æ¨¡æ¿ç±»åŒæ—¶ä¹Ÿåœ¨å±•å¼€å‚æ•°åŒ…ï¼Œè¿™ä¸ªå±•å¼€è¿‡ç¨‹æ˜¯é€šè¿‡ç»§æ‰¿å‘èµ·çš„ï¼Œç›´åˆ°é‡åˆ°ç‰¹åŒ–çš„ç»ˆæ­¢æ¡ä»¶å±•å¼€è¿‡ç¨‹æ‰ç»“æŸã€‚`MakeIndexes<3>::type` çš„å±•å¼€è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š

```C++
MakeIndexes<3> : MakeIndexes<2, 2> {}
MakeIndexes<2, 2> : MakeIndexes<1, 1, 2> {}
MakeIndexes<1, 1, 2> : MakeIndexes<0, 0, 1, 2> {
    using type = IndexSeq<0, 1, 2>;
}
```

é€šè¿‡ä¸æ–­çš„ç»§æ‰¿é€’å½’è°ƒç”¨ï¼Œæœ€ç»ˆå¾—åˆ°æ•´å‹åºåˆ—IndexSeq<0, 1, 2>ã€‚

å¦‚æœä¸å¸Œæœ›é€šè¿‡ç»§æ‰¿æ–¹å¼å»ç”Ÿæˆæ•´å‹åºåˆ—ï¼Œåˆ™å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ç”Ÿæˆï¼š

```C++
#include <iostream>
using namespace std;

//æ•´å‹åºåˆ—çš„å®šä¹‰
template <int...>
struct IndexSeq {};

// éç»§æ‰¿æ–¹å¼ å¼€å§‹å±•å¼€å‚æ•°åŒ…
template<int N, int... Indexes>
struct MakeIndexes {
    using type = typename MakeIndexes<N-1, N-1, Indexes...>::type;
};

// æ¨¡æ¿ç‰¹åŒ– ç»ˆæ­¢å±•å¼€å‚æ•°åŒ…çš„æ¡ä»¶
template<int... Indexes>
struct MakeIndexes<0, Indexes...> {
    using type = IndexSeq<Indexes...>;
};

int main() {
    using T = MakeIndexes<3>::type;
    cout << typeid(T).name() << endl;
    return 0;
}
```

æˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•åˆ©ç”¨ã€Œé€’å½’ã€ä»¥åŠã€Œåç‰¹åŒ–ã€ç­‰æ–¹æ³•æ¥å±•å¼€ã€Œå¯å˜æ¨¡æ¿å‚æ•°ã€ï¼Œé‚£ä¹ˆå®é™…å½“ä¸­æˆ‘ä»¬ä¼šæ€ä¹ˆå»ä½¿ç”¨å®ƒå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨å¯å˜æ¨¡æ¿å‚æ•°æ¥æ¶ˆé™¤ä¸€äº›é‡å¤çš„ä»£ç ä»¥åŠå®ç°ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å¯å˜æ¨¡æ¿å‚æ•°çš„ä¸€äº›åº”ç”¨ã€‚

## å¯å˜å‚æ•°æ¨¡æ¿æ¶ˆé™¤é‡å¤ä»£ç 

C++11 ä¹‹å‰å¦‚æœè¦å†™ä¸€ä¸ªæ³›åŒ–çš„å·¥å‚å‡½æ•°ï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°èƒ½æ¥å—ä»»æ„ç±»å‹çš„å…¥å‚ï¼Œå¹¶ä¸”å‚æ•°ä¸ªæ•°è¦èƒ½æ»¡è¶³å¤§éƒ¨åˆ†çš„åº”ç”¨éœ€æ±‚çš„è¯ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å®šä¹‰å¾ˆå¤šé‡å¤çš„æ¨¡æ¿å®šä¹‰ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š

```C++
template<typename T>
T *Instance() {
    return new T();
}

template<typename T, typename T0>
T *Instance(T0 arg0) {
    return new T(arg0);
}

template<typename T, typename T0, typename T1>
T *Instance(T0 arg0, T1 arg1) {
    return new T(arg0, arg1);
}

template<typename T, typename T0, typename T1, typename T2>
T *Instance(T0 arg0, T1 arg1, T2 arg2) {
    return new T(arg0, arg1, arg2);
}

template<typename T, typename T0, typename T1, typename T2, typename T3>
T *Instance(T0 arg0, T1 arg1, T2 arg2, T3 arg3) {
    return new T(arg0, arg1, arg2, arg3);
}

template<typename T, typename T0, typename T1, typename T2, typename T3, typename T4>
T *Instance(T0 arg0, T1 arg1, T2 arg2, T3 arg3, T4 arg4) {
    return new T(arg0, arg1, arg2, arg3, arg4);
}

struct A {
    A(int) {}
};
struct B {
    B(int, double) {}
};

A *pa = Instance<A>(1);
B *pb = Instance<B>(1, 2);
```

å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ³›å‹å·¥å‚å‡½æ•°å­˜åœ¨å¤§é‡çš„é‡å¤çš„æ¨¡æ¿å®šä¹‰ï¼Œå¹¶ä¸”é™å®šäº†æ¨¡æ¿å‚æ•°ã€‚ç”¨å¯å˜æ¨¡æ¿å‚æ•°å¯ä»¥æ¶ˆé™¤é‡å¤ï¼ŒåŒæ—¶å»æ‰å‚æ•°ä¸ªæ•°çš„é™åˆ¶ï¼Œä»£ç å¾ˆç®€æ´ï¼Œé€šè¿‡å¯å˜å‚æ•°æ¨¡æ¿ä¼˜åŒ–åçš„å·¥å‚å‡½æ•°å¦‚ä¸‹ï¼š

```C++
template<typename T, typename... Args>
T *Instance(Args... args) {
    return new T(args...);
}
```

åœ¨ä¸Šé¢çš„å®ç°ä»£ç  `T *Instance(Args... args)` ä¸­ï¼Œ`Args` æ˜¯å€¼æ‹·è´çš„ï¼Œå­˜åœ¨æ€§èƒ½æŸè€—ï¼Œå¯ä»¥é€šè¿‡å®Œç¾è½¬å‘æ¥æ¶ˆé™¤æŸè€—ï¼Œä»£ç å¦‚ä¸‹ï¼š

```C++
template<typename T, typename... Args>
T *Instance(Args&&... args) {
    return new T(std::forward<Args>(args)...);
}

struct A {
    A(int) {}
};
struct B {
    B(int, double) {}
};

A *pa = Instance<A>(1);
B *pb = Instance<B>(1, 2);
```

å¯å˜å‚æ•°æ¨¡æ¿å®ç°æ³›åŒ–çš„ `delegate`
C++ ä¸­æ²¡æœ‰ç±»ä¼¼ C# çš„å§”æ‰˜ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©å¯å˜æ¨¡æ¿å‚æ•°æ¥å®ç°ä¸€ä¸ªã€‚C# ä¸­çš„å§”æ‰˜çš„åŸºæœ¬ç”¨æ³•æ˜¯è¿™æ ·çš„ï¼š

```C++
delegate int AggregateDelegate(int x, int y); // å£°æ˜å§”æ‰˜ç±»å‹

int Add(int x, int y) { return x + y; }
int Sub(int x, int y) { return x - y; }

AggregateDelegate add = Add;
add(1, 2); // è°ƒç”¨å§”æ‰˜å¯¹è±¡æ±‚å’Œ
AggregateDelegate sub = Sub;
sub(2, 1); // è°ƒç”¨å§”æ‰˜å¯¹è±¡ç›¸å‡
```

C# ä¸­çš„å§”æ‰˜çš„ä½¿ç”¨éœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªå§”æ‰˜ç±»å‹ï¼Œè¿™ä¸ªå§”æ‰˜ç±»å‹ä¸èƒ½æ³›åŒ–ï¼Œå³å§”æ‰˜ç±»å‹ä¸€æ—¦å£°æ˜ä¹‹åå°±ä¸èƒ½å†ç”¨æ¥æ¥å—å…¶å®ƒç±»å‹çš„å‡½æ•°äº†ï¼Œæ¯”å¦‚è¿™æ ·ç”¨ï¼š

```C++
int Fun(int x, int y, int z) { return x + y + z; }
int Fun1(string s, string r) { return s.Length + r.Length; }
AggregateDelegate fun = Fun;   //ç¼–è¯‘æŠ¥é”™ï¼Œåªèƒ½èµ‹å€¼ç›¸åŒç±»å‹çš„å‡½æ•°
AggregateDelegate fun1 = Fun1; //ç¼–è¯‘æŠ¥é”™ï¼Œå‚æ•°ç±»å‹ä¸åŒ¹é…
```

è¿™é‡Œä¸èƒ½æ³›åŒ–çš„åŸå› æ˜¯å£°æ˜å§”æ‰˜ç±»å‹çš„æ—¶å€™å°±é™å®šäº†ã€Œå‚æ•°ç±»å‹ã€å’Œã€Œä¸ªæ•°ã€ï¼Œåœ¨ C++11 é‡Œä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜äº†ï¼Œå› ä¸ºæœ‰äº†å¯å˜æ¨¡æ¿å‚æ•°ï¼Œå®ƒå°±ä»£è¡¨äº†ä»»æ„ç±»å‹å’Œä¸ªæ•°çš„å‚æ•°äº†ï¼Œä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å®ç°ä¸€ä¸ªåŠŸèƒ½æ›´åŠ æ³›åŒ–çš„ C++ ç‰ˆæœ¬çš„å§”æ‰˜ï¼ˆè¿™é‡Œä¸ºäº†ç®€å•èµ·è§åªå¤„ç†æˆå‘˜å‡½æ•°çš„æƒ…å†µï¼Œå¹¶ä¸”å¿½ç•¥ `constã€volatile` å’Œ `const volatile` æˆå‘˜å‡½æ•°çš„å¤„ç†ï¼‰ã€‚

```C++
#include <iostream>
using namespace std;

template<typename T, typename R, typename... Args>
class MyDelegate {
public:
    MyDelegate(T *t, R (T::*f)(Args...)) : m_t(t), m_f(f) {}

    R operator()(Args&&... args) {
        return (m_t->*m_f)(std::forward<Args>(args)...);
    }

private:
    T *m_t;
    R (T::*m_f)(Args...);   // å‡½æ•°æŒ‡é’ˆ
};

template<typename T, typename R, typename... Args>
MyDelegate<T, R, Args...> CreateDelegate(T *t, R (T::*f)(Args...)) {
    return MyDelegate<T, R, Args...>(t, f);
}

struct A {
    void Fun(int i ) { cout << i << endl; }
    void Fun1(int i, double j) { cout << i+j << endl; }
};

int main() {
    A a;
    auto d = CreateDelegate(&a, &A::Fun);   // åˆ›å»ºå§”æ‰˜
    d(1);                                   // è°ƒç”¨å§”æ‰˜ å°†è¾“å‡º1
    auto d1 = CreateDelegate(&a, &A::Fun1); // åˆ›å»ºå§”æ‰˜
    d1(1, 2.5);                             // è°ƒç”¨å§”æ‰˜ å°†è¾“å‡º3.5
    return 0;
}
```

`MyDelegate` å®ç°çš„ã€Œå…³é”®ã€æ˜¯å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªèƒ½æ¥å—ä»»æ„ç±»å‹å’Œå‚æ•°ä¸ªæ•°çš„ã€Œä¸‡èƒ½å‡½æ•°ã€ï¼š`R  (T::*m_f)(Args...)`ï¼Œæ­£æ˜¯ç”±äºã€Œå¯å˜æ¨¡æ¿å‚æ•°ã€çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰èƒ½å¤Ÿè®©è¿™ä¸ª m_f æ¥å—ä»»æ„å‚æ•°ã€‚

æ€»ç»“
ä½¿ç”¨å¯å˜æ¨¡æ¿å‚æ•°çš„è¿™äº›æŠ€å·§ç›¸ä¿¡è¯»è€…çœ‹äº†ä¼šæœ‰è€³ç›®ä¸€æ–°ä¹‹æ„Ÿï¼Œä½¿ç”¨å¯å˜æ¨¡æ¿å‚æ•°çš„å…³é”®æ˜¯å¦‚ä½•å±•å¼€å‚æ•°åŒ…ï¼Œå±•å¼€å‚æ•°åŒ…çš„è¿‡ç¨‹æ˜¯å¾ˆç²¾å¦™çš„ï¼Œä½“ç°äº†æ³›åŒ–ä¹‹ç¾ã€é€’å½’ä¹‹ç¾ï¼Œæ­£æ˜¯å› ä¸ºå®ƒå…·æœ‰ç¥å¥‡çš„ã€Œé­”åŠ›ã€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ›´æ³›åŒ–çš„å»å¤„ç†é—®é¢˜ï¼Œæ¯”å¦‚ç”¨å®ƒæ¥æ¶ˆé™¤é‡å¤çš„æ¨¡æ¿å®šä¹‰ï¼Œç”¨å®ƒæ¥å®šä¹‰ä¸€ä¸ªèƒ½æ¥å—ä»»æ„å‚æ•°çš„ã€Œä¸‡èƒ½å‡½æ•°ã€ç­‰ã€‚å…¶å®ï¼Œå¯å˜æ¨¡æ¿å‚æ•°çš„ä½œç”¨è¿œä¸æ­¢æ–‡ä¸­åˆ—ä¸¾çš„é‚£äº›ä½œç”¨ï¼Œå®ƒè¿˜å¯ä»¥å’Œå…¶å®ƒ C++11 ç‰¹æ€§ç»“åˆèµ·æ¥ï¼Œæ¯”å¦‚ `type_traits`ã€`std::tuple` ç­‰ç‰¹æ€§ï¼Œå‘æŒ¥æ›´åŠ å¼ºå¤§çš„å¨åŠ›ã€‚

